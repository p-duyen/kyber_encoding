\begin{tikzpicture}[thick]
  % --- init up to p^a ---
  \begin{scope}[xshift=0cm]
      \draw (0,\rate) node[left, sparsam] {$N$};
      \draw (0,-\rate) node[left, sparsam] {$K$};

      \draw[next] (0,\rate) -- node {\bitwidth} node[bitwidth] {$r$} (.7,\rate);
      \draw[next] (0,-\rate) -- node {\bitwidth} node[bitwidth] {$c$} (.7,-\rate);



    \draw (.95,0) \permdpa{a};
  \end{scope}

  % --- enc P1 ---
  \begin{scope}[xshift=1.2cm]
    \draw (.8,-\rate) \xordpa{AuthPad};
    \draw[next] (0,-\rate) -- (AuthPad);
    \draw[next] (AuthPad) +(0,-\msg) node[below] {$K$} -- (AuthPad);
    \draw[next] (AuthPad) -- node {\bitwidth} node [bitwidth] {$c$} +(1.3, 0);

    %\draw[dashdotted] (.8,1.5) -- (.8,-1.5);

    \draw (1.3,\rate) \xorspa{P1};
    \draw[next] (0,\rate) -- node[near start] {\bitwidth} node[near start, bitwidth] {$r$} (P1);
    \draw[next] (P1) +(0,\msg) node[above, color = orange] {$M_1$} -- (P1);
    \draw[next] (P1) -- +(2*\minnext,0);
    \draw[next] (P1) ++(.5,0) -- +(0,\msg) node[above] {$C_1$};

    \draw (2.35,0) \permspa{b};
  \end{scope}

  % --- enc Pt-1 ---
  \begin{scope}[xshift=3.8cm]
    \draw[dotted] (0,\rate) -- (\minnext,\rate)
                  (0,-\rate) -- (\minnext,-\rate);

    \draw[next] (\minnext,-\rate) -- node[pos=.4] {\bitwidth} node [pos=.4,bitwidth] {$c$} +(1.3,0);

    \draw (.9,\rate) \xorspa{Pt1};
    \draw[next] (\minnext,\rate) -- (Pt1);
    \draw[next] (Pt1) +(0,\msg) node[above, color = orange] {$M_{m\!-\!1}$ \hspace*{.15cm}} -- (Pt1);
    \draw[next] (Pt1) -- +(.8,0);
    \draw[next] (Pt1) ++(.5,0) -- +(0,\msg) node[above] {\hspace*{.2cm} $C_{m\!-\!1}$};

    \draw (1.95,0) \permspa{b};
  \end{scope}

  % --- enc Pt and finalize ---
  \begin{scope}[xshift=6.0cm]
    \draw (.5,\rate) \xorspa{Pt};
    \draw[next] (0,\rate) -- (Pt);
    \draw[next] (Pt) +(0,\msg) node[above, color = orange] {$M_m$} -- (Pt);
    \draw[next] (Pt) ++(.5,0) -- +(0,\msg) node[above] {$C_m$};
    \draw[next] (Pt) -- node[pos=.7] {\bitwidth} node[pos=.7,bitwidth] {$r$} +(1.6,0);

    %\draw[dashdotted] (1.3,1.5) -- (1.3,-1.5);

    \draw (1.5,-\rate) \xordpa{Kf};
    \draw[next] (Kf) +(0,-\msg) node[below] {$K$} -- (Kf);
    \draw[next] (0,-\rate) -- node[pos=.3] {\bitwidth} node[pos=.3,bitwidth] {$c$} (Kf);
    \draw[next] (Kf) -- (2.1,-\rate);

    \draw (2.35,0) \permdpa{a};

    \draw (3.3,-\rate) \xordpa{Kt};
    \draw[next] (Kt) +(0,-\msg) node[below] {$K$} -- (Kt);
    \draw[next] (2.6,-\rate) -- node[pos=.4] {\bitwidth} node[pos=.4,bitwidth] {$k$} (Kt);
    \draw (4.0,-\rate) node[name=T,sparsam] {$T$};
    \draw[next] (Kt) -- (T);
  \end{scope}

\end{tikzpicture}